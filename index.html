<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Parqu√≠metro Municipal</title>

  <!-- Estilos propios -->
  <link rel="stylesheet" href="styles.css" />
  <meta name="google-site-verification" content="jBcTaPNzet0G1826RnAs6AFh4KXF6rHJvEJ4ncYYOKQ" />

  <!-- Font Awesome para iconos -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-pEMXkpLtTkiZeXak+Ro2GPiZq33/OarBnVPpmhqAHaoTh20yUtYe8wOzjLWXRC6qSQi70YGy3aBoTAT+XJd5Vg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <!-- Leaflet CSS y JS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />
  <script
    src="https://unpkg.com/leaflet/dist/leaflet.js">
  </script>

  <!-- Reset b√°sico -->
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar__logo">üöó Vialidad</div>
    <nav class="sidebar__nav">
      <a href="index.html"><i class="fa-solid fa-clock"></i> Temporizador</a>
      <a href="notifications.html"><i class="fa-solid fa-bell"></i> Notificaciones</a>
      <a href="profile.html" class="active"><i class="fa-solid fa-user"></i> Mi perfil</a>
      <a href="preferencias.html"><i class="fa-solid fa-gear"></i> Preferencias</a>
      <a href="seguridad.html"><i class="fa-solid fa-shield"></i> Seguridad</a>
      <a href="integraciones.html"><i class="fa-solid fa-plug"></i> Integraciones</a>
      <a href="ayuda.html"><i class="fa-solid fa-circle-question"></i> Ayuda</a>
    </nav>
  </aside>

  <!-- Contenido principal -->
  <main class="main-content">
    <header class="main-content__header">
      <h1>Parqu√≠metro Municipal</h1>
      <button id="toggle-theme" class="theme-toggle" title="Cambiar tema">
        <i class="fa-solid fa-moon"></i>
      </button>
    </header>

    <!-- Bot√≥n para activar notificaciones -->
    <button id="enable-notifs">üîî Activar Notificaciones</button>

    <!-- Temporizador con progreso circular -->
    <section class="card timer-card">
      <div class="progress-circle">
        <svg><circle cx="100" cy="100" r="90"/></svg>
        <div class="timer-display" id="timer">00:00</div>
      </div>
      <div class="timer-controls">
        <button id="add"><i class="fa-solid fa-plus"></i> 1 Min</button>
        <button id="start"><i class="fa-solid fa-play"></i> Iniciar</button>
        <button id="reset"><i class="fa-solid fa-rotate-right"></i> Reiniciar</button>
      </div>
      <div class="cost-display">
        <label for="zone">Zona:</label>
        <select id="zone">
          <option value="1.5">Centro ‚Äì 1.5 MXN/min</option>
          <option value="2">Residencial ‚Äì 2 MXN/min</option>
          <option value="3">Comercial ‚Äì 3 MXN/min</option>
        </select>
        <div class="cost-text">Costo estimado: <strong id="cost">0.00</strong> MXN</div>
      </div>
    </section>

    <!-- Formulario de veh√≠culo -->
<section class="card profile-form">
  <h2>Informaci√≥n del veh√≠culo</h2>
  <form id="vehiculoForm">
    <div class="form-group">
      <label for="placa">Placa</label>
      <input type="text" id="placa" placeholder="ABC-1234">
    </div>
    <div class="form-group">
      <label for="modelo">Modelo</label>
      <input type="text" id="modelo" placeholder="Marca y modelo">
    </div>
    <div class="form-group">
      <label for="color">Color</label>
      <input type="text" id="color" placeholder="Color del veh√≠culo">
    </div>
    <div class="form-group">
      <label for="propietario">Propietario</label>
      <input type="text" id="propietario" placeholder="Nombre completo">
    </div>
    <div class="form-group">
      <label for="telefono">Tel√©fono</label>
      <input type="tel" id="telefono" placeholder="55 1234 5678">
    </div>
    <button type="submit" class="btn-submit">
      <i class="fa-solid fa-floppy-disk"></i> Guardar datos
    </button>
  </form>
</section>


     <!-- Mapa Leaflet -->
<section class="card map-section">
      <h2>Zonas de Parqu√≠metro</h2>
      <div id="map" style="height: 400px; border-radius:8px;"></div>
    </section>

    <!-- Historial persistente -->
    <section class="card history">
      <h2>Historial de sesiones</h2>
      <ul id="history-list"></ul>
      <button id="export-pdf" class="btn-export">üìÑ Descargar comprobante (PDF)</button>
      <button id="clear-history" class="btn-clear">Limpiar historial</button>
    </section>


  </main>

  
  <script>
  async function cargarHistorialVehiculos() {
    const lista = document.getElementById("history-list");
    lista.innerHTML = "";

    try {
      const snapshot = await db.collection("vehiculos").orderBy("fechaRegistro", "desc").get();
      snapshot.forEach(doc => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `üöó ${data.placa} - ${data.modelo} (${data.color}) registrado el ${data.fechaRegistro}`;
        lista.appendChild(li);
      });
    } catch (error) {
      console.error("Error cargando historial:", error);
    }
  }

  // Cargar historial al abrir la p√°gina
  window.addEventListener("DOMContentLoaded", cargarHistorialVehiculos);
</script>


<script>
  document.getElementById("clear-history").addEventListener("click", async () => {
  const confirmacion = confirm("¬øEst√°s seguro de que deseas eliminar todo el historial?");
  if (!confirmacion) return;

  const snapshot = await db.collection("vehiculos").get();
  const batch = db.batch();

  snapshot.forEach(doc => {
    batch.delete(doc.ref);
  });

  await batch.commit();
  alert("Historial eliminado.");
  document.getElementById("history-list").innerHTML = "";
});

</script>




  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="script.js"></script>


<!-- Firebase SDKs (si no lo has puesto ya) -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBj-RYATrlO_uh9wrv6lv5eQ0bGg3u0J_U",
    authDomain: "soborsculturavial.firebaseapp.com",
    projectId: "soborsculturavial",
    storageBucket: "soborsculturavial.appspot.com",
    messagingSenderId: "111508775675",
    appId: "1:111508775675:web:11e1213a7aec9400d1065e"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>


  <script>
  const formVehiculo = document.getElementById("vehiculoForm");

  formVehiculo.addEventListener("submit", async (e) => {
    e.preventDefault();

    const placa = document.getElementById("placa").value.trim();
    const modelo = document.getElementById("modelo").value.trim();
    const color = document.getElementById("color").value.trim();
    const propietario = document.getElementById("propietario").value.trim();
    const telefono = document.getElementById("telefono").value.trim();

    if (!placa || !modelo || !color || !propietario || !telefono) {
      alert("Por favor llena todos los campos.");
      return;
    }

    try {
      await db.collection("vehiculos").add({
        placa,
        modelo,
        color,
        propietario,
        telefono,
        fechaRegistro: new Date().toLocaleString()
      });

      alert("‚úÖ Veh√≠culo guardado correctamente.");
      formVehiculo.reset();
    } catch (error) {
      console.error("‚ùå Error al guardar veh√≠culo:", error);
      alert("Ocurri√≥ un error al guardar.");
    }
  });
</script>




</body>
</html>
